window.__require=function t(e,o,i){function c(n,a){if(!o[n]){if(!e[n]){var s=n.split("/");if(s=s[s.length-1],!e[s]){var p="function"==typeof __require&&__require;if(!a&&p)return p(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+n+"'")}n=s}var l=o[n]={exports:{}};e[n][0].call(l.exports,function(t){return c(e[n][1][t]||t)},l,l.exports,t,e,o,i)}return o[n].exports}for(var r="function"==typeof __require&&__require,n=0;n<i.length;n++)c(i[n]);return c}({CarPhysics:[function(t,e,o){"use strict";cc._RF.push(e,"2e16bXhskpGUZwfj7MvDhxO","CarPhysics");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n,a=cc._decorator,s=a.ccclass;a.property,function(t){t[t.NONE=0]="NONE",t[t.SAND=1]="SAND",t[t.GRASS=2]="GRASS",t[t.OIL=3]="OIL"}(n||(n={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rotationAngle=0,e.accelerationFactor=50,e.turnFactor=300,e.driftMagnitude=1,e.maxSpeed=100,e.accelerationInput=0,e.steeringInput=0,e.friction=3,e.body=null,e.forwardVelocity=cc.v2(),e.rightVelocity=cc.v2(),e.surface=n.NONE,e}return c(e,t),e.prototype.onLoad=function(){this.body=this.node.getComponent(cc.RigidBody),cc.director.getPhysicsManager().enabled=!0,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),cc.view.enableAutoFullScreen(!0)},e.prototype.onDisable=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.up:this.accelerationInput=1;break;case cc.macro.KEY.down:this.accelerationInput=-1;break;case cc.macro.KEY.left:this.steeringInput=1;break;case cc.macro.KEY.right:this.steeringInput=-1}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.up:case cc.macro.KEY.down:this.accelerationInput=0;break;case cc.macro.KEY.left:case cc.macro.KEY.right:this.steeringInput=0}},e.prototype.update=function(t){this.applyForce(t),this.applySteering(t),this.forwardVelocity=this.calculateForce(),this.rightVelocity=this.calculateSteerForce(),this.killOrthogonalVelocity(),this.limitCarSpeed()},e.prototype.onBeginContact=function(t,e,o){switch(console.log("Begin Contact with:",o.node.name),o.node.name){case"oil":case"sand":case"grass":this.surface=n.OIL}},e.prototype.onEndContact=function(t,e,o){console.log("End Contact with:",o.node.name),this.surface=n.NONE},e.prototype.applyForce=function(){switch(0==this.accelerationInput?this.body.linearDamping=this.friction*(1-this.driftMagnitude):this.body.linearDamping=0,this.surface){case n.OIL:this.body.linearDamping=0;break;case n.SAND:this.body.linearDamping=1.5*this.friction*(1-this.driftMagnitude);break;case n.GRASS:this.body.linearDamping=.8*this.friction*(1-this.driftMagnitude)}var t=-cc.misc.degreesToRadians(-this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t)).mul(this.accelerationInput*this.accelerationFactor);this.body.applyForceToCenter(e,!0)},e.prototype.applySteering=function(t){var e=this.body.linearVelocity.mag(),o=cc.misc.clampf(e/this.maxSpeed,0,1),i=cc.v2(Math.cos(cc.misc.degreesToRadians(this.node.angle)),Math.sin(cc.misc.degreesToRadians(this.node.angle))),c=this.body.linearVelocity.dot(i)>0?-this.steeringInput:this.steeringInput;this.rotationAngle-=c*this.turnFactor*o*t;var r=cc.misc.degreesToRadians(this.rotationAngle);this.node.angle=cc.misc.radiansToDegrees(r)},e.prototype.limitCarSpeed=function(){var t=this.body.linearVelocity;if(t.mag()>this.maxSpeed){var e=t.normalize().multiplyScalar(this.maxSpeed);this.body.linearVelocity=e}},e.prototype.killOrthogonalVelocity=function(){var t=this.rightVelocity.mag(),e=this.rightVelocity.normalize(),o=t*this.driftMagnitude,i=e.mul(o),c=this.forwardVelocity.add(i);this.body.linearVelocity=c},e.prototype.isTireScreeching=function(){var t=this.calcForwardVelocity();return this.accelerationInput>0&&t<this.accelerationFactor||this.accelerationInput<0&&t>10||this.rightVelocity.mag()>20},e.prototype.calcForwardVelocity=function(){var t=-cc.misc.degreesToRadians(-this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t));return cc.Vec2.dot(this.body.linearVelocity,e)},e.prototype.calculateForce=function(){var t=-cc.misc.degreesToRadians(-this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t));return e.multiplyScalar(cc.Vec2.dot(this.body.linearVelocity,e))},e.prototype.calculateSteerForce=function(){var t=-cc.misc.degreesToRadians(-this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t)),o=cc.v2(-e.y,e.x);return o.multiplyScalar(cc.Vec2.dot(this.body.linearVelocity,o))},r([s],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],Controller:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Controller");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,s=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.accelerationFactor=50,e.driftMagnitude=.9,e.maxSpeed=200,e.turnFactor=200,e.frictionFactor=1,e.moveInput=0,e.rotateInput=0,e.accelerationInput=0,e.steeringInput=0,e.body=null,e.rotationAngle=0,e.forwardVelocity=cc.v2(),e.rightVelocity=cc.v2(),e}return c(e,t),e.prototype.onLoad=function(){this.body=this.node.getComponent(cc.RigidBody),this.resetPhysics(),cc.director.getPhysicsManager().enabled=!0,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.resetPhysics=function(){this.body.angularDamping=0,this.body.linearDamping=0,this.body.linearVelocity=cc.v2(),this.body.angularVelocity=0},e.prototype.onDisable=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.w:this.moveInput=1;break;case cc.macro.KEY.s:this.moveInput=-1;break;case cc.macro.KEY.a:this.rotateInput=1;break;case cc.macro.KEY.d:this.rotateInput=-1}this.setInputVector()},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.w:case cc.macro.KEY.s:this.moveInput=0;break;case cc.macro.KEY.a:case cc.macro.KEY.d:this.rotateInput=0}this.setInputVector()},e.prototype.isTireScreeching=function(){var t=this.calcForwardVelocity();return this.accelerationInput>0&&t<this.accelerationFactor/2||this.accelerationInput<0&&t>10||this.rightVelocity.mag()>10*this.frictionFactor},e.prototype.calcForwardVelocity=function(){var t=-cc.misc.degreesToRadians(-this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t));return cc.Vec2.dot(this.body.linearVelocity,e)},e.prototype.setInputVector=function(){this.accelerationInput=this.moveInput,this.steeringInput=this.rotateInput},e.prototype.lateUpdate=function(t){this.applyForce(t),this.applySteering(t),this.forwardVelocity=this.getForwardVelocity(),this.rightVelocity=this.getRightVelocity(),this.killOrthogonalVelocity(),this.limitCarSpeed()},e.prototype.adjustFriction=function(){this.driftMagnitude>0?this.body.linearDamping=this.frictionFactor*(1-this.driftMagnitude):this.body.linearDamping=this.frictionFactor},e.prototype.applyForce=function(){0==this.accelerationInput?this.body.linearDamping=this.frictionFactor*(1-this.driftMagnitude):this.body.linearDamping=0;var t=cc.misc.degreesToRadians(this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t)).mul(this.accelerationInput*this.accelerationFactor);this.body.applyForceToCenter(e,!0)},e.prototype.applySteering=function(t){var e=this.body.linearVelocity.mag(),o=cc.misc.clampf(e/this.maxSpeed,0,1),i=cc.v2(Math.cos(cc.misc.degreesToRadians(this.node.angle)),Math.sin(cc.misc.degreesToRadians(this.node.angle))),c=this.body.linearVelocity.dot(i)>0?-this.steeringInput:this.steeringInput;this.rotationAngle-=c*this.turnFactor*o*t;var r=cc.misc.degreesToRadians(this.rotationAngle);this.node.angle=cc.misc.radiansToDegrees(r)},e.prototype.limitCarSpeed=function(){var t=this.body.linearVelocity;if(t.mag()>this.maxSpeed){var e=t.normalize().mul(this.maxSpeed);this.body.linearVelocity=e}},e.prototype.killOrthogonalVelocity=function(){var t=this.rightVelocity.mag(),e=this.rightVelocity.normalize(),o=t*this.driftMagnitude,i=e.mul(o),c=this.forwardVelocity.add(i);this.body.linearVelocity=c},e.prototype.getForwardVelocity=function(){var t=cc.misc.degreesToRadians(this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t));return e.mul(cc.Vec2.dot(this.body.linearVelocity,e))},e.prototype.getRightVelocity=function(){var t=cc.misc.degreesToRadians(this.node.angle),e=cc.v2(Math.cos(t),Math.sin(t)),o=cc.v2(-e.y,e.x);return o.mul(cc.Vec2.dot(this.body.linearVelocity,o))},r([a],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],FollowCamera:[function(t,e,o){"use strict";cc._RF.push(e,"c1fa2d9fI5Ig44XO/NwATu+","FollowCamera");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,s=n.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.car=null,e}return c(e,t),e.prototype.onLoad=function(){var t=this.car.getPosition();t.x=cc.misc.clampf(t.x,-cc.winSize.width/2,cc.winSize.width/2),t.y=cc.misc.clampf(t.y,-cc.winSize.height/2,cc.winSize.height/2),this.node.setPosition(t)},e.prototype.lateUpdate=function(t){this.follow(t)},e.prototype.follow=function(){var t=this.car.getPosition();t.x=cc.misc.clampf(t.x,-cc.winSize.width/2,cc.winSize.width/2),t.y=cc.misc.clampf(t.y,-cc.winSize.height/2,cc.winSize.height/2);var e=this.node.getPosition();e.lerp(t,.2,e),this.node.setPosition(e)},r([s(cc.Node)],e.prototype,"car",void 0),r([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],ManualController:[function(t,e,o){"use strict";cc._RF.push(e,"156299Y0BxDaqCPvkcP6FwN","ManualController");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,s=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=150,e.rotationSpeed=10,e.driftFactor=1,e.moveInput=0,e.rotateInput=0,e.body=null,e.magnitude=50,e}return c(e,t),e.prototype.onLoad=function(){this.body=this.node.getComponent(cc.RigidBody),cc.director.getPhysicsManager().enabled=!0,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.schedule(this.fixedUpdate,.06)},e.prototype.onDisable=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.up:this.moveInput=1;break;case cc.macro.KEY.down:this.moveInput=-1;break;case cc.macro.KEY.left:this.rotateInput=1;break;case cc.macro.KEY.right:this.rotateInput=-1}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.up:case cc.macro.KEY.down:this.moveInput=0;break;case cc.macro.KEY.left:case cc.macro.KEY.right:this.rotateInput=0}},e.prototype.fixedUpdate=function(){var t=this.body.linearVelocity.mag()/this.magnitude;t=cc.misc.clamp01(t);var e=this.node.angle+this.rotateInput*this.rotationSpeed*t,o=cc.misc.degreesToRadians(e),i=cc.v2(Math.cos(o),Math.sin(o)),c=cc.v2(-i.y,i.x),r=i.mul(this.speed*this.moveInput),n=c.mul(this.speed*this.rotateInput*.5),a=r.add(n.mul(this.driftFactor));this.body.applyForceToCenter(a,!0),this.node.angle=e},r([a],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],Obstackle:[function(t,e,o){"use strict";cc._RF.push(e,"0d7f9brUrFJZaOfJzw9JknY","Obstackle");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,s=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.onLoad=function(){this.node.getComponent(cc.RigidBody).enabledContactListener=!0},r([a],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],TrailEffect:[function(t,e,o){"use strict";cc._RF.push(e,"97ce4V9xhdHF73Zbn+fok8o","TrailEffect");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CarPhysics"),a=cc._decorator,s=a.ccclass,p=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skidMarkPrefab=null,e.skidLayer=null,e.car=null,e.skidMarkInterval=5,e.lastSkidMarkTime=0,e.fadingDuration=3,e.trailArray=[],e}return c(e,t),e.prototype.start=function(){this.trailArray=[],this.lastSkidMarkTime=0},e.prototype.update=function(){this.car.isTireScreeching()?Date.now()-this.lastSkidMarkTime>this.skidMarkInterval&&(this.manageSkidMark(),this.lastSkidMarkTime=Date.now()):this.removeAllSkids()},e.prototype.removeAllSkids=function(){var t=this;this.trailArray.forEach(function(e){e.runAction(cc.sequence(cc.fadeOut(t.fadingDuration),cc.callFunc(function(){e.destroy()})))}),this.trailArray=[]},e.prototype.manageSkidMark=function(){var t=this.createSkidMark();if(this.trailArray.push(t),this.trailArray.length>100){var e=this.trailArray.shift();e.runAction(cc.sequence(cc.fadeOut(this.fadingDuration),cc.callFunc(function(){e.destroy()})))}},e.prototype.createSkidMark=function(){var t=cc.instantiate(this.skidMarkPrefab);t.width=3,t.height=3;var e=this.node.convertToWorldSpaceAR(cc.Vec3.ZERO),o=this.car.node.parent.convertToNodeSpaceAR(e);return t.setPosition(o),t.angle=this.car.node.angle,this.skidLayer.addChild(t),t},r([p(cc.Prefab)],e.prototype,"skidMarkPrefab",void 0),r([p(cc.Node)],e.prototype,"skidLayer",void 0),r([p(n.default)],e.prototype,"car",void 0),r([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./CarPhysics":"CarPhysics"}],TrailGraphics:[function(t,e,o){"use strict";cc._RF.push(e,"7be4fsnjUdG75/Laz3+AQrR","TrailGraphics");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CarPhysics"),a=cc._decorator,s=a.ccclass,p=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.car=null,e.previousPositions=[],e.maxTrailLength=500,e.trailWidth=5,e.skidMarkInterval=5,e.lastSkidMarkTime=0,e.fadingDuration=1,e}return c(e,t),e.prototype.update=function(){if(this.car.isTireScreeching()&&Date.now()-this.lastSkidMarkTime>this.skidMarkInterval){var t=this.node.convertToWorldSpaceAR(cc.Vec3.ZERO),e=this.car.node.parent.convertToNodeSpaceAR(t);this.addPositionToTrail(cc.v2(e.x,e.y)),this.drawTrailWithFade(),this.lastSkidMarkTime=Date.now()}},e.prototype.addPositionToTrail=function(t){this.previousPositions.push(t),this.previousPositions.length>this.maxTrailLength&&this.previousPositions.shift()},e.prototype.drawTrail=function(){this.graphics.clear(),this.graphics.lineWidth=this.trailWidth,this.graphics.strokeColor=cc.Color.WHITE,this.previousPositions.length>0&&this.graphics.moveTo(this.previousPositions[0].x,this.previousPositions[0].y);for(var t=1;t<this.previousPositions.length;t++)this.graphics.lineTo(this.previousPositions[t].x,this.previousPositions[t].y);this.graphics.stroke()},e.prototype.drawTrailWithFade=function(){this.graphics.clear();for(var t=1;t<this.previousPositions.length;t++){var e=t/this.previousPositions.length,o=Math.floor(255*e),i=new cc.Color(255,255,255,o);this.graphics.lineWidth=this.trailWidth,this.graphics.strokeColor=i,this.graphics.moveTo(this.previousPositions[t-1].x,this.previousPositions[t-1].y),this.graphics.lineTo(this.previousPositions[t].x,this.previousPositions[t].y),this.graphics.stroke()}},r([p(cc.Graphics)],e.prototype,"graphics",void 0),r([p(n.default)],e.prototype,"car",void 0),r([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./CarPhysics":"CarPhysics"}],Unity:[function(t,e,o){"use strict";cc._RF.push(e,"d3d88evxBFBnInyINnqx2+Y","Unity");var i,c=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var c,r=arguments.length,n=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(n=(r<3?c(n):r>3?c(e,o,n):c(e,o))||n);return r>3&&n&&Object.defineProperty(e,o,n),n};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,s=n.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.acceleration=4,e.maxSpeed=10,e.turnFactor=2,e.driftFactor=.95,e.carRigidBody=null,e.accelerationInput=0,e.steeringInput=0,e.rotationAngle=0,e}return c(e,t),e.prototype.onLoad=function(){cc.director.getPhysicsManager().enabled=!0,this.carRigidBody=this.getComponent(cc.RigidBody),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onDisable=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.up:this.accelerationInput=1;break;case cc.macro.KEY.down:this.accelerationInput=-1;break;case cc.macro.KEY.left:this.steeringInput=1;break;case cc.macro.KEY.right:this.steeringInput=-1}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.up:case cc.macro.KEY.down:this.accelerationInput=0;break;case cc.macro.KEY.left:case cc.macro.KEY.right:this.steeringInput=0}},e.prototype.lateUpdate=function(){this.applyEngineForce(),this.applySteering()},e.prototype.applyEngineForce=function(){if(0===this.accelerationInput?this.carRigidBody.linearDamping=cc.misc.lerp(this.carRigidBody.linearDamping,2,.1):this.carRigidBody.linearDamping=.1,!(this.carRigidBody.linearVelocity.dot(cc.v2(this.node.up.x,this.node.up.y))>this.maxSpeed&&this.accelerationInput>0)){var t=this.node.up.mul(this.acceleration*this.accelerationInput);this.carRigidBody.applyForceToCenter(cc.v2(t.x,t.y),!0)}},e.prototype.applySteering=function(){this.rotationAngle+=this.steeringInput*this.turnFactor,this.node.angle=this.rotationAngle},e.prototype.killLateralVelocity=function(){var t=this.node.up.mul(this.carRigidBody.linearVelocity.dot(cc.v2(this.node.up.x,this.node.up.y))),e=this.node.right,o=e.mul(this.carRigidBody.linearVelocity.dot(cc.v2(e.x,e.y))),i=t.add(o.mul(this.driftFactor));this.carRigidBody.linearVelocity=cc.v2(i.x,i.y)},r([s],e.prototype,"acceleration",void 0),r([s],e.prototype,"maxSpeed",void 0),r([s],e.prototype,"turnFactor",void 0),r([s],e.prototype,"driftFactor",void 0),r([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{}]},{},["CarPhysics","Controller","FollowCamera","ManualController","Obstackle","TrailEffect","TrailGraphics","Unity"]);